name: DeSmuME

on:
  - push
  - pull_request

jobs:
  build:
    name: Build DeSmuME (Linux)
    runs-on: ubuntu-20.04

    steps:
      - name: checkout
        uses: actions/checkout@v3

      - name: install dependencies
        run: sudo apt update && sudo apt install meson libsdl2-dev libpcap-dev libgtk-3-dev

      # - name: meson
      #   run: |
      #     cd desmume/src/frontend/posix/
      #     meson build

      # - name: ninja
      #   run: ninja -C desmume/src/frontend/posix/build

      # - name: Pack artifact
      #   run: |
      #     cd desmume/src/frontend/posix/
      #     tar cJf DeSmuME_dev_linux.tar.xz build/

      # - name: Upload artifact
      #   uses: actions/upload-artifact@v3
      #   with:
      #     name: DeSmuME_dev_linux
      #     path: desmume/src/frontend/posix/DeSmuME_dev_linux.tar.xz

      - name: buildit
        run: |
          cd desmume/src/frontend/posix/
          autoreconf -i
          ./configure --prefix=/usr --enable-gdb-stub --enable-wifi
          make -j8
          make DESTDIR=/tmp/DeSmuME install

      - name: Pack artifact
        run: |
          cd /tmp
          tar cJf DeSmuME.tar.xz DeSmuME/

      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: desmume-linux-gtk2-cli-x86_64
          path: /tmp/DeSmuME.tar.xz
